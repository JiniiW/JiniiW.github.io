---
title: "[JAVA] 자바가상머신(JVM)의 동작방식과 메모리 구조"
excerpt: "Java Virtual Machine"

categories:
  - Java
tags:
  - [java]

permalink: /java/2023-12-30-JAVA_JVM/

toc: true
toc_sticky: true

date: 2023-12-30
last_modified_at: 2023-12-30
---
## Intro
자바 코드를 작성하면서 객체를 정의하고 활용할 때, JVM에 대한 검색이 계속 필요했던 기억이 있다.<br>

예를 들면 어떤 메서드는 바로 호출해서 사용할 수 있고 어떤 메서드는 객체를 인스턴스화 해야 사용할 수 있는지가 궁금했다.

이 부분이 이해가 안되서 왜그럴까 생각을 해보면 메모리에 저장되는 공간이 다르기 때문이였다.

자바는 프로그램은 결국 JVM에서 실행되기 때문에 JVM의 메모리 구조를 이해하는 것이 중요다하고 생각해 한번 정리해보겠다.

---

먼저 JVM이 무엇인지 알아보자.<br>

JVM의 사전적인 정의이다.

> JVM : 자바 프로그램을 실행하기 위한 가상 머신으로, 자바 바이트 코드를 해당 OS에 맞는 기계어로 변환하고 실행하는 역할을 수행한다.

쉽게 말하면 JVM은 프로그램과 OS의 중간에 위치하여 작성된 자바 코드를 각 OS에 맞는 기계어로 번역하고 실행하여 어떤 OS에서든지 동작할 수 있게 도와준다.


그럼 이러한 JVM이 메모리와는 어떤 연관이 있는지 궁금할 수 있다.<br>
그러려면 먼저 JVM의 동작 방식을 알아야 한다.

## JVM 동작방식

<img src = "{{url}}/images/2023-12-30-Java_JVM/JVM.png" width="70%">

1. 자바 프로그램을 실행하면 JVM은 OS로부터 메모리를 할당받는다.
2. 자바 컴파일러가 자바 소스코드(Person.java)를 바이트 코드(Person.class)로 컴파일 한다.
3. Class Loader를 통해 JVM Runtime Area를 로딩한다.
4. Runtime Data Area에 로딩된 .class 파일은 Execution Engine을 통해 해석된다.
5. 해석된 .class 파일은 Runtime Data Area에서 해당하는 영역에 배치되어 수행된다.
6. Garbage Collertor를 통해 메모리를 최적화 한다.

>간단하게 정리해본다면 우리가 작성한 java 파일이 컴파일러를 통해 바이트 코드 파일로 변환되고 Runtime Data Area에서 해당되는 부분에 배치되어 실행되는 것이다.

<br>
그러면 java파일에서 어떤 내용이 Runtime Data Area의 어느 영역에 할당되는지 알아보자

<br>

## Runtime Data Area
JVM의 메모리 구조는 OS의 메모리 구조에 속한다. 

### 1. 메서드 영역 (Method Area)
(= Static Area, Class Area)

> 클래스 단위의 정보 저장

메서드 영역은 .java파일에서 컴파일된 .class파일이 저장되는 공간으로 클래스 단위의 정보가 저장된다. <br>
더 쉽게 말하면 해당 클래스의 구조를 기록한다고 생각하면 된다.

<br>
보통 <mark> 클래스의 코드, 모든 종류의 메서드, static 변수, 상수</mark> 등이 저장된다.<br>

**즉, 메서드 영역은 클래스 정보와 정적 데이터를 담는 공간이다.**

정적 변수는 컴파일시에 결정된 주소를 가지며 프로그램 실행 시 변경되지 않는다.
{: .notice}

<br>

### 2. 힙 영역 (Heap Area)
> 동적으로 생성된 객체 저장


힙 영역은 동적으로 생성된 객체의 인스턴스와 인스턴스 변수가 저장되는 영역으로 프로그램에서 객체가 생성되면 해당 객체와 그 객체의 데이터가 힙에 할당된다.<br>
일반적으로 `new`키워드를 사용하여 생성된 객체들이 저장된다.

힙 영역은 동적으로 생성된 객체를 저장하기 때문에 객체가 더이상 필요하지 않을 경우 Garbage Collector에 의해 수거된다.

<br>
보통 <mark> 인스턴스, 배열, 컬렉션 프레임워크, 사용자 정의 객체</mark>가 저장된다.<br>

**즉, 힙 영역은 런타임 중 변경되는 데이터를 저장하는 공간이다.**

힙 영역에 새로운 객체가 생길 때 메모리 주소가 동적으로 할당되기 때문에 해당 객체를 인스턴스화 하여 사용해야 한다.
{: .notice}

<br>

### 3. 스택 영역

> 각 스레드마다 메서드 호출 및 변수들의 정보 저장

스택 영역은 메인 스레드안에서 각각의 스레드 나뉜다.<br>
여기서 각각의 스레드는 독립적인 스택 프레임을 의미한다.

스택 프레임은 해당 스레드에서 실행중인 <mark>메서드의 호출 정보와 로컬 변수, 매개변수</mark> 등을 담고 있다.<br>
스택 프레임은 메서드가 호출 될 때 생성되고, 메서드 종료 시 제거된다.

**즉, 스택 영역은 메서드 호출과 관련된 데이터를 저장하는 공간이다.**

스택 영역의 메모리 주소는 런타임 중 결정된다.
{: .notice}

<br>

### 정리
메서드 영역은 클래스 정보와 정적 데이터를 저장하는 공간이며 힙 영역은 동적 데이터를, 스택 영역은 메서드 호출과 관련된 데이털를 저장하는 공간이다.

## Outro
그러면 여기까지 읽고 제일 처음 궁금했던 점에 대해 답을 할 수 있을까?<br>

메서드 영역에 저장되어 static 키워드가 붙은 변수와 메서드는 바로 사용할 수 있고 힙에 저장된 메서드는 객체를 인스턴스화 해야 사용이 가능했던 이유는 각각의 데이터가 할당되는 메모리 영역 다르기 때문이다.

앞으로 코드의 정보들이 어느 영역에 할당되는지를 생각하면 코드를 작성하고 이해하는데 훨씬 도움이 될것이다.

결국, 우리가 작성하는 자바 코드는 JVM에서 실행되기 때문에 JVM의 메모리 구조를 이해하는 것을 빼놓을 수 없다. 
이러한 메모리 구조에 대해 이해한다면 자바 프로그램의 동작 방식에 대해서도 같이 연관지어 생각할 수 있다.