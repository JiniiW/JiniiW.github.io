---
title: "[JAVA] 자바가상머신(JVM)의 동작방식과 메모리 구조"
excerpt: "Java Virtual Machine"

categories:
  - Java
tags:
  - [JVM, 메모리, 참조변수]

permalink: /java/2023-12-30-JAVA_JVM/

toc: true
toc_sticky: true

date: 2023-12-30
last_modified_at: 2024-01-13a
---
## Intro
처음에 자바를 배울때 예제코드를 따라치며 학습했다.

하지만 혼자 코드를 작성하면 같은 부분에서 오류가 발생해 왜 그럴까?라는 의문이 들었다.

그래서 반복되는 오류를 해결하려면 코드의 메모리 동작에 대한 이해가 필요하다고 생각했다.

자바라는 언어의 특징 중 하나가 JVM이 메모리를 관리를 해준다는 점이기 때문에 JVM의 동작방식과 메모리 구조에 대한 이해가 먼저 필요하다고 생각한다.

---

먼저 JVM이 무엇인지 알아보자.<br>

JVM의 사전적인 정의이다.

> JVM : 자바 프로그램을 실행하기 위한 가상 머신으로, 자바 바이트 코드를 해당 OS에 맞는 기계어로 변환하고 실행하는 역할을 수행한다.

쉽게 말하면 JVM은 프로그램과 OS의 중간에 위치하여 작성된 자바 코드를 각 OS에 맞는 기계어로 번역하고 실행하여 어떤 OS에서든지 동작할 수 있게 도와준다.


그럼 이러한 JVM이 메모리와는 어떤 연관이 있는지 궁금할 수 있다.<br>
그러려면 먼저 JVM의 동작 방식을 알아야 한다.

## JVM 동작방식

<img src = "{{url}}/images/2023-12-30-Java_JVM/JVM.png" width="70%">

1. 자바 프로그램을 실행하면 JVM은 OS로부터 메모리를 할당받는다.
2. 자바 컴파일러(javac)가 자바 소스코드(.java)를 바이트 코드(.class)로 컴파일 한다.
3. Class Loader를 통해 Runtime Data Area에 로딩한다.
4. Runtime Data Area에 로딩된 바이트 코드는 Execution Engine을 통해 기계어로 해석된다.
5. Garbage Collertor를 통해 메모리를 최적화 한다.

>간단하게 정리해본다면 우리가 작성한 java 파일이 컴파일러를 통해 바이트 코드 파일로 변환되고 Runtime Data Area에서 해당되는 부분에 배치되어 실행되는 것이다.

<br>
그러면 우리가 작성한 코드가 Runtime Data Area의 어느 영역에 할당되는지 알아보자

<br>

## Runtime Data Area
JVM의 메모리 구조는 OS의 메모리 구조에 속한다. 

### 1. 메서드 영역 (Method Area)
(= Static Area, Class Area)

> 클래스 단위의 정보 저장

메서드 영역은 .java파일에서 컴파일된 .class파일(바이트코드)이 저장되는 공간으로 클래스 단위의 정보가 저장된다. <br>

처음 메모리 공간에 올릴 때 초기화 되는 대상을 저장하기 위한 공간인 것이다.
간단하게 클래스의 구조를 기록한다고 생각하면 된다.

때문에 JVM시작시 생성되어 프로그램 종료시까지 유지된다.

#### 저장정보
보통 **클래스의 코드, 모든 종류의 메서드, static 변수, 상수** 등이 저장된다.<br>

>메서드 영역은 클래스 정보와 정적 데이터를 담는 공간

메서드 영역은 컴파일시 정보를 초기화 하고 런타임 중 메모리에 저장한다.
{: .notice--success}

<br>

### 2. 힙 영역 (Heap Area)
> 동적으로 생성된 객체 저장

힙 영역은 동적으로 생성된 객체의 인스턴스와 인스턴스 변수가 저장되는 영역으로 프로그램에서 객체가 생성되면 해당 객체와 그 객체의 데이터가 힙에 할당되는 것이다.

힙 영역은 동적으로 생성된 객체를 저장하기 때문에 객체가 더이상 필요하지 않을 경우 Garbage Collector에 의해 수거된다.

#### 저장정보

보통 **new연산자로 생성되는 클래스, 인스턴스, 배열, 컬렉션 프레임워크**가 저장된다.

>힙 영역은 런타임 중 변경되는 데이터를 저장하는 공간

#### 참조타입

이렇게 힙 영역에 저장된 객체는 참조타입이라고 한다.
스택영역에서 힙 영역에 저장된 객체의 정보를 필요로 할때 주소에 직접 접근하는 것이 아닌 변수를 새로 선언해서 해당 변수에 저장된 주소를 통해 간접적으로 접근하기 때문이다.

```java
class Dog{}

public class Exampe{
  public static void main(String[]) args
    {
        //힙 영역에 Dog 객체를 생성하고 참조변수 dog1에 할당
        Dog dog1 = new Dog();
    }
}
```

힙 영역은 객체의 메모리 주소가 동적으로 할당되기 때문에 런타임 중 메모리에 저장된다.
{: .notice--success}

<br>

### 3. 스택 영역(Stack Area)

> 각 스레드마다 메서드 호출 및 변수들의 정보 저장

스택 영역은 메인 스레드안에서 각각의 스레드 나뉜다.<br>
여기서 각각의 스레드는 독립적인 스택 프레임을 가진다.

#### 저장정보
스택 프레임은 해당 스레드에서 실행중인 **메서드의 호출 정보와 로컬 변수, 매개변수**등을 담고 있으며 모두 임시적으로 사용된다.<br>

>스택 영역은 메서드 호촐과 관련된 정보를 담는 공간

예를 들어 메인 스레드에서 메서드를 호출하게 되면 해당 스레드가 생성되며 매개변수가 스택 프레임을 가지게 된다.<br>
또한 스택 프레임은 메서드가 호출 될 때 생성되고, 메서드 종료 시 제거된다.


스택 영역은 메서드 호출에 따라 동적으로 스택 프레임이 할당되기 때문에 런타임 중 메모리에 저장된다.
{: .notice--success}

<br>

### 정리
메서드 영역은 클래스 정보와 정적 데이터를 저장하는 공간이며 힙 영역은 동적 데이터를, 스택 영역은 메서드 호출과 관련된 데이터를 저장하는 공간이다.

## Outro
이렇게 JVM의 메모리 구조에 대해 정리하면서 각각의 영역의 정보가 메모리에 언제 저장되는지 실행되는지에 대해 개념을 정리할 수 있었다.

결국, 우리가 작성하는 자바 코드는 JVM에서 실행되기 때문에 JVM의 메모리 구조를 이해하는 것을 빼놓을 수 없다고 생각한다. 이러한 이해는 앞으로 개발자로서 코드를 효율적으로 작성하고 메모리 관리 측면에서의 최적화도 기대할 수 있을 것이다.