---
title: "[JAVA] 스레드의 상태"
excerpt: "Thread Status"

categories:
  - Java
tags:
  - [thread, os, status]

permalink: /2024-01-16-Java_Thread_Status/

toc: true
toc_sticky: true

date: 2024-01-16
last_modified_at: 2024-01-16
---

## Intro
자바의 스레드 개념을 기록을 남기게 된 이유는 스레드에 대해 공부하면서 그만큼 중요하다는 중요하다는 생각이 들었기 때문이다.

만약 스레드를 활용하지 않으면 여러 작업을 동시에 처리하지 못하게 되며 이는 프로그램의 완성도에 큰 영향을 끼칠 수 있기 때문에 이에 대한 이해가 필수라고 생각한다.

특히 스레드의 상태를 다루는 이유는 프로그램의 실행되는 동안 흐름을 파악하고, 동시성 문제(데드락, 교착상태 등)를 예방하여 안정적이고 효율적인 **멀티스레드 프로그래밍**을 가능하게 하도록 위해서이기 때문이다.

그러면 이제 스레드의 상태에 들어가기 전에 스레드 자체가 무엇인지 알아보자.

---

## 1. 스레드란?
> 프로세스의 실행 흐름 단위

라는 일반적인 정의를 내릴 수 있다.

그러면 자바에서의 스레드는 어떤 의미일까?

자바는 멀티스레드 프로그래밍을 직접적으로 지원하는 언어이다.<br> 
여기서 직접적이라는 의미는 개발자가 직접 스레드를 생성하고 조절할 수 있다는 것이다.<br>
이게 가능한 이뉴는 JVM(Java Virtual Machine)이 스레드를 관리하며 다양한 클래스 및 인터페이스를 제공하기 때문이다.<br> 
  - class : Thread
  - Interface : Runnable
  - keyworld : synchronized(동기화)
  - method<br>

이러한 지원을 통해 스레드의 상태를 쉽게 다룰 수 있는 것이다.

## 2. 스레드의 상태
그러면 이제 스레드의 상태는 어떤 것들이 있는지 알아보자.

가장 먼저 java의 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Thread.State.html"><span style = "color : red">API 공식문서</span></a>를 살펴볼 수 있다.

대표적인 부분만 이미지로 보면<br>

<img src = "{{url}}/images/2024-01-16-Java_thread/thread_status_api.png" width="100%">

6가지의 상태가 존재할 수 있다는 것을 확인할 수 있다.

각각을 직역을 하면 다음 의미와 갔다.
1. **NEW** : 스레드가 아직 시작되지 않은 상태입니다.
2. **RUNNABLE** : 스레드가 JVM에서 실행중인 상태입니다.
3. **BLOCKED** : 스레드가 모니터 락을 기다리며 차단되어 있는 상태입니다.
4. **WAITING** : 스레드가 다른 스레드의 작업이 끝나기를 기다리는 상태입니다.
5. **TIMED_WAITING** : 스레드가 지정된 대기 시간까지 다른 스레드가 작업을 수행하는 시간을 기다리는 상태입니다.
6. **TERMINATED** : 스레드가 종료된 상태 입니다.

스레드는 일종의 실행흐름으로 볼 수 있는데 프로그램 실행 시 메모리에 생성되고, 작업을 수행한 후에는 소멸되는 주기를 가진다.<br>
그럼 그림을 통해 흐름을 알아보자.
<img src = "{{url}}/images/2024-01-16-Java_thread/thread_status.png" width="100%">

### 1. NEW
스레드가 새로 생성된 상태다.

### 2. RUNNABLE
> admitted : 프로세스가 시스템에 접수되어 대기중인 상태

스레드가 `start()`메서드를 통해 실행대기 상태 이거나 실행중인 상태다.<br>

#### 실행대기
스레드의 상태가 NEW에서 RUNNABLE로 바뀐다고 바로 실행이 되는 것이 아니다.<br>
RUNNABLE의 실행대기 상태는 스레드가 CPU의 할당을 기다리는 상태로 실행 순서는 CPU 스케줄러 의해 결정된다.

#### 실행상태(Ruuning)
> dispatch : 프로세스나 스레드가 CPU에 할당되어 실행되기 시작하는 상태

스레드가 CPU를 할당받아 실행중인 상태이다.


### 3. BLOCKED
실행중인 스레드가 일시 중단 되어 특정 조건을 기다리는 상태이다.

그러면 특정 조건이 어떤 것들이 있을까? <br>
대표적으로 sychronized(동기화)와 I/O(입출력 작업)이 있는데 이에 대해 알아보자.

#### sychronized 
sychronized는 동기화의 의미로 여러 스레드가 접근하는 코드 블록은 `sychronized`키워드를 통해 보호할 수 있다.<br>
해당 블록에 진입하려는 스레드는 현재 다른 스레드에 의해 점유 되어있는지 확인하고, 만약 점유되어 있다면 락을 얻을 때 까지 대기하게 된다. <br> 
이때 스레드 상태를 블럭상태라고 하는 것이다.<br>
이후 락을 가진 스레드가 sychronized 블럭을 빠져나가면 대기중인 스레드가 락을 얻고 실행 가능한 상태로 전환된다.

  - 락을 가진 스레드는 동기화 블록에서 실행중이거나 블록을 빠져나가기 직전이다.
  - 락을 얻기위해 대기중인 스레드는 블럭 상태이다.

> 락(lock) : 여러 스레드가 공유된 자원에 접근하지 못하게 막아주는 도구

#### I/O
입출력 작업은 시스템 리소스에 대한 외부 요청을 포함하며 작업이 완료되길 기다려야 한다.<br>
예를 들어 설명하자면 파일에서 데이터를 읽거나 네트워크를 통해 데이터를 전송하는 경우 스레드는 해당 작업이 완료되기를 기다리는 동안 블록상태에 있는 것이다.<br>

### 4. WAITING
실행중인 스레드가 `wait()`메서드나 `join()`메서드를 통해 일시 중지되어 있는 상태다.
`interrupt()`를 통해 RUNNABLE의 실행 대기 상태로 돌아갈 수 있으며, wait()는 `notify()`나 `notifyAll()`메서드도 사용 가능하다.

이때, notify()와 notifyAll()은 object 클래스를 상속받은 메서드인데 그 이유는 모든 객체가 공통적으로 사용할 수 있는 동기화 도구를 제공하기 위해서다.
### 5. TIMED_WAITING
실행중인 스레드가 `sleep()`메서드 통해 일정 시간 동안 일시 중지되어 있는 상태다.<br>
주어진 시간이 끝나거나(timeout) `interrupt()`메서드를 통해 RUNNABLE의 실행대기 상태로 돌아간다.

### 6. TERMINATED
스레드의 작업이 완료되서 종료된 상태이다.

---
## Outro
스레드의 실행상태에 대해 정리하면서 스레드 자체에 대한 정의도 내릴 수 있게 됐다.<br>
막연하게 의미는 알고 있었지만 실제로 이해를 했다는 점이다.<br>
또한 각각의 상태에 대한 개념을 다루면서 프로그램의 실행 흐름에 대한 이해도 높일 수 있게 되었다.<br>
이러한 지식을 토대로 앞으로 안정적이고 효율적인 멑티프로세스 프로그래밍을 구현하며 성취감을 느끼고 싶다.