---
title: "[운영체제] 프로세스"
excerpt: "프로세스"

categories:
  - OS
tags:
  - [프로세스]

permalink: /os/2024-01-02-운영체제_프로세스/

toc: true
toc_sticky: true

date: 2024-01-03
last_modified_at: 2024-01-06
---

운영체제는 컴퓨터 시스템의 핵심 부분으로, 다양한 작업을 관리하고 조율하는 역할을 한다.<br>
특히 프로세스는 운영체제에서 중요한 개념으로, 여러 프로그램간의 실행을 관리하며 시스템의 자원을 효율적으로 활용할 수 있도록 지원한다.

> 프로세스 : 실행중인 프로그램

보조기억장치에 저장된 프로그램을 메모리에 적재하고 실행하는 순간 프로그램은 프로세스가 된다.<br>
유닉스 계열에서 `ps`명령어로 확인할 수 있다.

## 1. 프로세스 확인하기
프로세스는 사용자가 볼 수 있는 공간과 볼 수 없는 공간에서 실행된다.
- 포그라운드 프로세스 : 사용자가 직접 확인할 수 있는 화면에서 실행되는 프로세스이다.
- 백그라운드 프로세스 : 사용자의 시야에 보이지 않아 직접적으로 실행되지 않는 프로세스이다.
  - 유닉스 운영체제 -> 데몬
  - 윈도우 운영체제 -> 서비스
<br>

### 결론
사용자의 시각에서 보이는 프로세스는 주로 포그라운드에서 실행되며, 시스템이나 서버와 같이 숨겨진 작업을 수행하는 프로세스는 백그라운드에서 동작한다.
이러한 특징은 운영체제의 안정성과 효율성을 유지하기 위한 필수적인 개념이다.

## 2. 프로세스 제어 블록(PCB)
프로세스는 CPU를 필요로 하지만 동시에 사용할 수 없기 때문에 정해진 시간만큼 사용하며 **인터럽트**가 발생하면 다른 프로세스에게 양보하고 대기한다.

이를 가능하게 하는 핵심 도구 중 하나가 PCB이다.

> PCB : 프로세스와 관련된 정보를 저장하는 자료구조

PCB는 해당 프로세스를 식별하기 위한 정보들이 저장되며 운영체제의 핵심 서비스이기 프로세스 생성 시 커널영역에서 만들어지고 실행이 끝나면 폐기된다.

### 1. 저장되는 정보
PCB에 저장되는 정보는 프로세스ID, 레지스터 값, 프로세스 상태, CPU 스케줄링 정보, 메모리 관리 정보, 사용자 파일과 입출력장치 목록 등이 있다.
1. 프로세스 ID [PID] : 특정 프로세스를 식별하기 위해 부여하는 고유한 번호이다.
  - 같은 일을 수행하는 프로그램이더라도 2번 실행하면 다른 PID를 가진 두 개의 프로세스가 실행된다.
2. 레지스터 값 : 프로세스는 이전에 했던 작업을 그대로 실행하기 위해 PCB에 사용했던 프로그램 카운터를 비롯한 레지스터 값들을 저장한다.
3. 메모리 관리 정보 : 프로세스마다 메모리에 저장된 위치가 다르기 때문에 PCB에 해당 정보가 있어야 한다.
  - 테이블 정보도 포함된다.

결론적으로 운영체제는 커널 영역에 적재된 PCB를 보고 프로세스를 관리한다.
{: .notice}

### 2. 문맥 교환
하나의 프로세스가 다른 프로세스로 실행 순서를 넘기고 후에 수행을 재개하기 위해 기억해야 할 정보를 문맥이라 한다. <br>
하나의 프로세스 문맥은 해당 프로세스의 PCB에 표현된다. 
> 문맥 교환 : 프로세스가 바뀌는 과정

운영체제는 기존 프로세스 실행 중에 인터럽트가 발생하면 PCB에 프로세스의 문맥을 백업 시키며, 다음에 실행할 프로세스의 문맥을 복구시킨다.

문맥 교환은 여러 프로세스가 끊임없이 빠르게 번갈아 가며 실행되는 원리로 사용자의 눈에는 프로세스들이 동시에 실행되는 것처럼 보인다.

### 3. 프로세스 메모리 영역
사용자 영역에 배치되는 크게 코드영역, 데이터 영역, 힙 영역, 스택 영역으로 나뉘어 저장된다.

<img src = "{{url}}/images/2024-01-02-OS_process/프로세스_메모리_영역.png" width = "50%">

코드 영역과 데이터 영역은 크기가 고정 되어 있어 정적 할당 영역이라 한다. <br>
힙 영역과 스택 영역은 실시간으로 크기가 변할 수 있기 때문에 동적 할당 영역이라 한다. <br>
두개의 영역은 크기가 변하기 때문에 데이터가 쌓여도 새롭게 할당되는 주소가 겹치지 않도록 다른 순서로 할당 받는다.<br>
- 힙 영역은 : 낮은 주소 -> 높은 주소<br>
- 스택 영역 : 높은 주소 -> 낮은 주소

1. 코드 영역 : 기계어로 이루어진 명령어가 저장되기 때문에 쓰기가 금지된 읽기 전용 공간이다.
2. 데이터 영역 : 프로그램이 실행되는 동안 유지할 데이터가 저장된다.
  - 대표적으로 전역변수가 있다.
3. 힙 영역 : 프로그래머가 직접 할당 할 수 있는 저장공간이다.
  - 힙 영역에 메모리 공간 할당 시 반환이 필수이다. 
  - 만약 메모리 반환을 해주지 않으면 메모리 누수가 발생한다.
4. 스택 영역 : 데이터를 일시적으로 저장하는 공간으로 PUSH와 POP이 이루어진다.
  - 매개변수, 지역변수가 대표적이다.

#### 결론
PCB는 프로세스에 대한 정보를 저장하며 문맥교환을 통해 효율적인 CPU전환을 가능게한다. <br>
또한 프로세스의 메모리 영역을 관리하여 운영체가 메모리를 효율적으로 할당할 수 있도록 한다. <br>

## 3. 프로세스 상태와 계층 구조
프로세스들은 각자의 상태를 가지고 계층적인 구조를 이루고 있다.
운영체제는 이러한 프로세스의 상태를 PCB에 기록한다. 
### 1. 프로세스 상태
프로세스가 가지는 대표적인 상태로는 생성 상태, 준비 상태, 실행 상태, 대기 상태, 종료 상태가 있다.
1. 생성 상태 : 프로세스를 생성 중인 상태를 생성 상태라 하며 메모리에 적재되어 PCB를 할당 받아 CPU의 할당을 기다린다.
2. 준비 상태 : 자신의 차례를 기다리는 상태이다. <br>
  * 준비 상태에서 실행 상태 전환을 디스패치라 한다.
3. 실행 상태 : CPU를 할당받아 실행중인 상태이다.
4. 대기 상태 : 입출력 작업은 CPU에 비해 처리속도가 느리끼 때문에 해당 작업을 끝날때까지 기다리는 상태이다. 
5. 종료 상태 : 프로세스가 종료된 상태로 PCB가 사용한 메모리를 정리한다.

[상태 다이어그램]<br>
<img src = "{{url}}/images/2024-01-02-OS_process/프로세스_상태_다이어그램.png" width = "70%">

### 2. 프로세스 계층 구조
프로세스는 실행 중 시스템 호출을 통해 다른 프로세스를 호출할 수 있다.
- 부모 프로세스 : 새 프로세스를 생성한 프로세스
- 자식 프로세스 : 부모 프로세스에 의해 생성된 프로세스
<br>
이렇게 부모 프로세스가 자식 프로세스를 생성하는 구조를 프로세스 계층 구조라 한다.
프로세스 계층 구조에서 최상위 부모 프로세스를 최초의 프로세스라 한다.<br>

-> 데몬과 서비스 또한 부모 프로세스의 자식 프로세스이다.<br>

### 3. 프로세스 생성 기법
부모 프로세스는 fork를 통해 자신의 복사본을 자식 프로세스로 생성하고 만들어진 복사본은 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체한다.<br>

**[시스템 호출]**
- fork : 자기 자신 프로세스의 복사본을 만드는 시스템 호출이다.
  - 부모의 자원(메모리 내용, 열린 파일 목록)등이 자식 프로세스에 상속 된다.
  - 상속이 되더라도 PID값이나 저장된 메모리 위치는 다르다.
- exec : 자식 프로세스가 자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출이다.
  - 코드 영역과 데이터 영역의 내용이 실행할 프로그램의 내용으로 바뀌고 나머지 영역은 초기화 된다.

#### 결론
프로세스에서 계층 구조를 이루는 것은 부모가 자식 프로세스를 실행하여 fork와 exec를 반복하는 과정이라 볼 수 있다. <br>
만약 자식 프로세스가 exec를 호출하지 않는 경우에는 부모와 같은 코드를 실행하는 프로세스가 된다.

