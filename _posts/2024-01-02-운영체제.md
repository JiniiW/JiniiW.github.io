---
title: "[운영체제] 프레세스와 스레드"
excerpt: "프로세스와 스레드"

categories:
  - OS
tags:
  - [프로세스, 스레드]

permalink: /os/2024-01-02-운영체제/

toc: true
toc_sticky: true

date: 2024-01-03
last_modified_at: 
---

운영체제는 컴퓨터 시스템의 핵심 부분으로, 여러 가지 작업을 관리하고 조율하는 역할을 한다. 이 중에서도 프로세스와 스레드는 운영체제에서 중요한 개념으로, 효율적인 작업 분배와 자원 활용을 가능하게 한다.
# 프로세스와 스레드

> 프로세스 : 실행중인 프로그램

보조기억장치에 저장된 프로그램을 메모리에 적재하고 실행하는 순간 프로그램은 프로세스가 된다.

유닉스 계열에서 ps명령어로 확인할 수 있다.
## 프로세스
### 1. 프로세스 확인하기
프로세스는 사용자가 볼 수 있는 공간과 볼 수 없는 공간에서 실행된다.
- 포그라운드 프로세스 : 사용자가 직접 확인할 수 있는 화면에서 실행되는 프로세스이다.
- 백그라운드 프로세스 : 사용자의 시야에 보이지 않아 직접적으로 실행되지 않는 프로세스이다.
  - 유닉스 운영체제 에서는 데몬이라 한다.
  - 윈도우 운영체제 에서는 서비스라 한다.

#### 결론
사용자의 시각에서 보이는 프로세스는 주로 포그라운드에서 실행되며, 시스템이나 서버와 같이 숨겨진 작업을 수행하는 프로세스는 백그라운드에서 동작한다.
이러한 특징은 운영체제의 안정성과 효율성을 유지하기 위한 필수적인 개념이다.

<br>

### 2. 프로세스 제어 블록(PCB)
프로세스는 CPU를 필요로 하지만 동시에 사용할 수 없기 때문에 정해진 시간만큼 사용하며 인터럽트가 발생하면 다른 프로세스에게 양보하고 대기한다.

이를 가능하게 하는 핵심 도구 중 하나가 PCB이다.

> PCB : 프로세스와 관련된 정보를 저장하는 자료구조

프로세스 제어 블럭은 프로세스와 관련된 정보를 저장하는 자료구조로 해당 프로세스를 식별하기 위한 정보들이 저장된다.
<br>
PCB는 운영체제의 핵심 서비스이기 프로세스 생성 시 커널영역에서 만들어지고 실행이 끝나면 폐기된다.

#### 1. 저장되는 정보
PCB에 저장되는 정보는 프로세스ID, 레지스터 값, 프로세스 상태, CPU 스케줄링 정보, 메모리 관리 정보, 사용자 파일과 입출력장치 목록 등이 있다.
1. 프로세스 ID [PID] : 특정 프로세스를 식별하기 위해 부여하는 고유한 번호이다.
  - 같은 일을 수행하는 프로그램이더라도 2번 실행하면 다른 PID를 가진 두 개의 프로세스가 실행된다.
2. 레지스터 값 : 프로세스는 이전에 했던 작업을 그대로 실행하기 위해 PCB에 사용했던 프로그램 카운터를 비롯한 레지스터 값들을 저장한다.
3. 메모리 관리 정보 : 프로세스마다 메모리에 저장된 위치가 다르기 때문에 PCB에 해당 정보가 있어야 한다.
  - 테이블 정보도 포함된다.

결론적으로 운영체제는 커널 영역에 적재된 PCB를 보고 프로세스를 관리한다.
#### 2. 문맥 교환
하나의 프로세스가 다른 프로세스로 실행 순서를 넘기고 후에 수행을 재개하기 위해 기억해야 할 정보를 문맥이라 한다.
하나의 프로세스 문맥은 해당 프로세스의 PCB에 표현된다. 
> 문맥 교환 : 프로세스가 바뀌는 과정

운영체제는 기존 프로세스 실행 중에 인터럽트가 발생하면 PCB에 프로세스의 문맥을 백업 시키며, 다음에 실행할 프로세스의 문맥을 복구시킨다.

이러한 과정을 문맥교환이라 한다.<br>
문맥 교환은 여러 프로세스가 끊임없이 빠르게 번갈아 가며 실행되는 원리로 사용자의 눈에는 프로세스들이 동시에 실행되는 것처럼 보인다.

#### 3. 프로세스 메모리 영역
사용자 영역에 배치되는 크게 코드영역, 데이터 영역, 힙 영역, 스택 영역으로 나뉘어 저장된다.

코드 영역과 데이터 영역은 크기가 고정 되어 있어 정적 할당 영역이라 한다.
힙 영역과 스택 영역은 실시간으로 크기가 변할 수 있기 때문에 동적 할당 영역이라 한다. <br>
두개의 영역은 크기가 변하기 때문에 데이터가 쌓여도 새롭게 할당되는 주소가 겹치지 않도록 다른 순서로 할당 받는다.<br>
- 힙 영역은 낮은 주소 -> 높은 주소 순서로 할당받는다.<br>
- 스택 영역은 높은 주소 -> 낮은 주소 순서로 할당받는다.

1. 코드 영역 : 기계어로 이루어진 명령어가 저장되기 때문에 쓰기가 금지된 읽기 전용 공간이다.
2. 데이터 영역 : 프로그램이 실행되는 동안 유지할 데이터가 저장된다.
  - 대표적으로 전역변수가 있다.
3. 힙 영역 : 프로그래머가 직접 할당 할 수 있는 저장공간이다.
  - 힙 영역에 메모리 공간 할당 시 반환이 필수이다. 
  - 만약 메모리 반환을 해주지 않으면 메모리 누수가 발생한다.
4. 스택 영역 : 데이터를 일시적으로 저장하는 공간으로 PUSH와 POP이 이루어진다.
  - 매개변수, 지역변수가 대표적이다.

#### 결론
PCB는 프로세스에 대한 정보를 저장하며 문맥교환을 통해 효율적인 CPU전환을 가능게한다. <br>
또한 프로세스의 메모리 영역을 관리하여 운영체가 메모리를 효율적으로 할당할 수 있도록 한다. <br>

### 3. 프로세스 상태와 계층 구조
프로세스들은 각자의 상태를 가지고 계층적인 구조를 이루고 있다.
운영체제는 이러한 프로세스의 상태를 PCB에 기록한다. 
#### 1. 프로세스 상태
프로세스가 가지는 대표적인 상태로는 생성 상태, 준비 상태, 실행 상태, 대기 상태, 종료 상태가 있다.
1. 생성 상태 : 프로세스를 생성 중인 상태를 생성 상태라 하며 메모리에 적재되어 PCB를 할당 받아 CPU의 할당을 기다린다.
2. 준비 상태 : 자신의 차례를 기다리는 상태이다. <br>
  * 준비 상태에서 실행 상태 전환을 디스패치라 한다.
3. 실행 상태 : CPU를 할당받아 실행중인 상태이다.
4. 대기 상태 : 입출력 작업은 CPU에 비해 처리속도가 느리끼 때문에 해당 작업을 끝날때까지 기다리는 상태이다. 
5. 종료 상태 : 프로세스가 종료된 상태로 PCB가 사용한 메모리를 정리한다.

<br>
이러한 상태를 프로세스 상태 다이어그램으로 표현할 수 있다. 

#### 2. 프로세스 계층 구조
프로세스는 실행 중 시스템 호출을 통해 다른 프로세스를 호출할 수 있다.
- 부모 프로세스 : 새 프로세스를 싱성한 프로세스
- 자식 프로세스 : 부모 프로세스에 의해 생성된 프로세스
<br>
이렇게 부모 프로세스가 자식 프로세스를 생성하는 구조를 프로세스 계층 구조라 한다.
프로세스 계층 구조에서 최상위 부모 프로세스를 최초의 프로세스라 한다.<br>
* 데몬과 서비스 또한 부모 프로세스의 자식 프로세스이다.<br>

#### 3. 프로세스 생성 기법
부모 프로세스는 fork를 통해 자신의 복사본을 자식 프로세스로 생성하고 만들어진 복사본은 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체한다.<br>
<br>

**[시스템 호출]**
- fork : 자기 자신 프로세스의 복사본을 만드는 시스템 호출이다.
  - 부모의 자원(메모리 내용, 열린 파일 목록)등이 자식 프로세스에 상속 된다.
  - 상속이 되더라도 PID값이나 저장된 메모리 위치는 다르다.
- exec : 자식 프로세스가 자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출이다.
  - 코드 영역과 데이터 영역의 내용이 실행할 프로그램의 내용으로 바뀌고 나머지 영역은 초기화 된다.

#### 결론
프로세스에서 계층 구조를 이루는 것은 부모가 자식 프로세스를 실행하여 fork와 exec를 반복하는 과정이라 볼 수 있다. <br>
만약 자식 프로세스가 exec를 호출하지 않는 경우에는 부모와 같은 코드를 실행하는 프로세스가 된다.

## 스레드
> 스레드 : 프로세스를 구성하는 실행 흐름 단위

스레드는 프로세스를 구성하는 실행 흐름 단위로 하나의 프로세스는 여러 개의 스레드를 가질 수 있다. <br>
이러한 스레드드를 이용하면 하나의 프로세스에서 여러 부분을 동시에 실행 가능하다. 

#### 1. 프로세스와 스레드
실행의 흐름 단위가 하나라는 가정하에 실행되는 프로세스들은 단일 프로세스로 볼 수 있다.<br>
여기서 스레드라는 개념이 도입되면서 하나의 프로세스가 한 번에 여러 일을 동시에 처리하게 되어 여러 명령어를 동시에 실행 할 수 있게 되었다.<br>
때문에 스레드는 프로세스를 구성하는 실행단위라 말할 수 있다.
<br>

> 스레드는 실행에 필요한 자원의 최소한의 정보(레지스터, 스택)만 유지한 채 프로세스 자원을 공유하며 실행 된다.

**결론**
프로레스가 실행되는 프로그램이라면 스레드는 프로세스를 구성하는 실행의 흐름 단위 이다. <br>
그리고 스레드는 자원을 공유한 채 최소한의 정보만으로 실행된다.

#### 2. 멀티프로세스와 멀티 스레드
- 멀티 프로세스 : 여러 프로세스를 동시에 실행한다.
- 멀티 스레드 : 여러 스레드로 프로세스를 동시에 실행한다.
<br>

**그럼 멀티 프로세스와 멀티 스레드의 실행 차이가 무엇일까?** <br>
> 프로세스와 스레드의 가장 큰 차이는 자원 공유 여부이다.

**1. 멀티 프로세스** <br>
멀티 프로세스는 동일한 프로세스를 동시에 실행하면 자원을 공유하지 않기 때문에 코드영역, 데이터 영역, 힙 영역을 비롯한 모든 자원이 복제되어 메모리에 적재된다.<br>
-> PID, 메모리 주소를 제외한 모든 것이 동일한 프로세스가 통째로 메로리에 여러개 적재된다. <br>
같은 프로그램을 실행하기 위해 메모리에 동일한 내용이 중복되기 때문에 낭비라고 할 수 있다.<br>
**2. 멀티 스레드** <br>
멀티 스레드는 각기 다른 스레드 ID, 레지스터 값, 스택만 가질뿐 나머지는 프로세스의 자원을 공유한다. <br>
때문에 멀티 프로세스보다 메모리를 더 효율적으로 사용할 수 있다.<br>
하지만 하나의 스레드에 문제가 발생할 경우 전체 프로세스가 영향을 받을 수 있다.
**정리**
멀티 프로세서는 독립적으로 실행되고 멀티 스레드는 프로세스의 자원 공유를 통해 협력과 통신에 유리하다.
#### + 프로세스간 통신
프로세스는 기본적으로 자원을 공유하지 않지만 데이터를 주고 받을 수 있다.<br>
이러한 과정을 프로세스간 통신(IPC)라 한다.<br>
파일 하나를 두 프로세스가 주고 받으면 파일을 통한 프로세스간 통신이라 볼 수 있다.

이렇게 프로세스간 통신을 위해 공유 메모리영역에 데이터를 두어 주고 받을 수 있게 했다. <br>
#### 결론
스레드는 프로세스의 실행 단위로 여러개의 스레드를 가진 하나의 프로세스는 동시에 여러 작업을 처리할 수 있다. <br>
여러 스레드로 프로세스를 동시에 실행하는 멀티 스레드는 메모리를 효율적으로 사용 가능하지만 하나의 프로세스에 문제가 발생할 경우 전체 프로세스가 영향을 받을 수 있다.<br>
여러 프로세스를 동시에 실행하는 멀티 프로세스는 메모리 낭비가 발생 할 수 있지만 다른 프로세스에 영향을 끼치지 않는다. 